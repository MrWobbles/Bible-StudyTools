<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Presenter View — Can I Trust the Bible? Class 1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b1f36;
      --panel: #0f2d4d;
      --accent: #f0b429;
      --text: #e6edf7;
      --muted: #9fb3cc;
      --shadow: 0 14px 36px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Space Grotesk', system-ui, -apple-system, sans-serif;
      background: radial-gradient(120% 120% at 10% 20%, rgba(240, 180, 41, 0.12), transparent 45%),
        radial-gradient(120% 120% at 90% 0%, rgba(73, 161, 255, 0.15), transparent 40%),
        linear-gradient(135deg, #071327 0%, #0b1f36 50%, #0a1c31 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 28px 16px 40px;
      display: flex;
      justify-content: center;
    }

    .page {
      width: min(1160px, 100%);
      display: grid;
      gap: 18px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .title-group { display: grid; gap: 4px; }

    h1 {
      margin: 0;
      font-size: clamp(24px, 3.4vw, 34px);
      letter-spacing: -0.02em;
    }

    .subtitle { margin: 0; color: var(--muted); font-size: 15px; }

    .pill-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      color: var(--text);
      text-decoration: none;
      font-weight: 700;
      letter-spacing: -0.01em;
      transition: all 0.2s ease;
    }

    .pill-link:hover { transform: translateY(-1px); }

    .layout {
      display: grid;
      gap: 16px;
      grid-template-columns: 1.8fr 1fr;
    }

    @media (max-width: 1100px) {
      .layout { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--panel);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .controls-grid {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    button {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 15px;
      font-weight: 700;
      letter-spacing: -0.01em;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button.primary {
      background: var(--accent);
      color: #0a1325;
      border-color: var(--accent);
      box-shadow: 0 6px 18px rgba(240, 180, 41, 0.35);
    }

    button:hover { transform: translateY(-1px); }

    .list { display: grid; gap: 10px; margin-top: 12px; }

    .list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
    }

    .list-item strong { letter-spacing: -0.01em; }
    .list-item small { color: var(--muted); }

    .rte {
      border: 1px solid rgba(255, 255, 255, 0.16);
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.14);
      padding: 6px;
      display: grid;
      gap: 8px;
    }

    .rte-toolbar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .rte-toolbar button {
      padding: 8px 10px;
      font-size: 14px;
      border-radius: 8px;
    }

    .rte-editor {
      min-height: 260px;
      padding: 10px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px dashed rgba(255, 255, 255, 0.12);
      color: var(--text);
      font-size: 15px;
      line-height: 1.6;
      outline: none;
    }

    .rte-editor h3, .rte-editor h4 { margin: 0.4em 0; }
    .rte-editor p { margin: 0.25em 0 0.45em; }
    .rte-editor ul, .rte-editor ol { margin: 0.25em 0 0.45em 1.25em; }

    .notes label { color: var(--muted); font-size: 14px; }

    .status {
      margin-top: 10px;
      color: var(--muted);
      font-size: 14px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.08);
      color: var(--muted);
      font-size: 13px;
      letter-spacing: -0.01em;
    }

    .note-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 8px 0 0;
    }

    .note-actions button {
      padding: 10px 12px;
      font-size: 14px;
    }

    details.accordion {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text);
    }

    details.accordion + details.accordion { margin-top: 8px; }

    details.accordion summary {
      cursor: pointer;
      font-weight: 700;
      letter-spacing: -0.01em;
      list-style: none;
    }

    details.accordion summary::-webkit-details-marker { display: none; }

    details.accordion ul {
      margin: 8px 0 0;
      padding-left: 18px;
      color: var(--muted);
      line-height: 1.5;
    }

    details.accordion a { color: var(--accent); }

    .question {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      padding: 10px 12px;
      display: grid;
      gap: 6px;
    }

    .question textarea {
      width: 100%;
      min-height: 100px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(0, 0, 0, 0.16);
      color: var(--text);
      padding: 10px;
      font-family: 'Space Grotesk', system-ui, -apple-system, sans-serif;
      font-size: 14px;
      resize: vertical;
    }

    .sticky {
      position: sticky;
      top: 16px;
      align-self: start;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="title-group">
        <h1>Presenter View · Can I Trust the Bible?</h1>
        <p class="subtitle">Class 1 · Keep this on your laptop while casting the main screen.</p>
      </div>
      <div class="title-group" style="align-items: flex-end; text-align: right;">
        <a class="pill-link" href="index.html" target="display-screen" rel="noopener">Open display page</a>
        <small class="subtitle">Load that window on the TV; control it from here.</small>
      </div>
    </header>

    <div class="layout">
      <section class="card" id="question-bank">
        <div class="tag">Outline & prompts</div>
        <h3 style="margin: 10px 0 8px;">Class 1 guide with notes</h3>

        <details class="accordion" open>
          <summary>Prayer for discernment (James 1:5-8)</summary>
          <div class="question">
            <p>Ask for wisdom, faith without doubting, and stability. Set the tone before the video begins.</p>
            <textarea data-question-key="prayer"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>Foundations and assumptions</summary>
          <div class="question">
            <p>Why do you personally trust or not trust the Bible? What shaped that view?</p>
            <textarea data-question-key="foundations-trust"></textarea>
          </div>
          <div class="question">
            <p>Respond to “You only believe because you grew up with it.”</p>
            <textarea data-question-key="foundations-upbringing"></textarea>
          </div>
          <div class="question">
            <p>If the Bible were unreliable, what happens to faith in Jesus?</p>
            <textarea data-question-key="foundations-unreliable"></textarea>
          </div>
          <div class="question">
            <p>Objections you have heard: errors, changed over time, wrong books.</p>
            <textarea data-question-key="foundations-objections"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>Canon and “right books”</summary>
          <div class="question">
            <p>What does “canon” mean? How were books chosen?</p>
            <textarea data-question-key="canon-meaning"></textarea>
          </div>
          <div class="question">
            <p>Initial thoughts on “lost gospels” (Thomas, Judas).</p>
            <textarea data-question-key="canon-lost-gospels"></textarea>
          </div>
          <div class="question">
            <p>Read 2 Tim 3:16; 2 Pet 1:20-21 — expectations for Scripture.</p>
            <textarea data-question-key="canon-2tim-2pet"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>00:07:05 · Recognizing Scripture</summary>
          <div class="question">
            <p>Video: <a href="https://youtu.be/QhVPBNBAGY0" target="_blank" rel="noopener">https://youtu.be/QhVPBNBAGY0</a></p>
            <textarea data-question-key="video-link"></textarea>
          </div>
          <div class="question">
            <p>Recognized, not “voted in” — why does recognition matter?</p>
            <textarea data-question-key="recognition-why"></textarea>
          </div>
          <div class="question">
            <p>Criteria hints (Luke 1:1-4; 1 John 1:1-3).</p>
            <textarea data-question-key="recognition-criteria"></textarea>
          </div>
          <div class="question">
            <p>OT–NT relationship and confidence in the right books.</p>
            <textarea data-question-key="recognition-ot-nt"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>00:13:45 · Other gospels (Gospel of Thomas)</summary>
          <div class="question">
            <p>Pseudonymous names to borrow authority — trust implications.</p>
            <textarea data-question-key="thomas-pseudonym"></textarea>
          </div>
          <div class="question">
            <p>Thomas = 114 sayings with secret knowledge; contrast the four Gospels.</p>
            <textarea data-question-key="thomas-contrast"></textarea>
          </div>
          <div class="question">
            <p>What feels out of step with Jesus in Matthew–John?</p>
            <textarea data-question-key="thomas-out-of-step"></textarea>
          </div>
          <div class="question">
            <p>Respond to “Church suppressed alternate Christianities.”</p>
            <textarea data-question-key="thomas-response"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>00:16:40 · Historical anchoring (names)</summary>
          <div class="question">
            <p>Name accuracy by time/place as reliability evidence.</p>
            <textarea data-question-key="names-evidence"></textarea>
          </div>
          <div class="question">
            <p>Forgery analogy (17th c. Paris) — why details matter.</p>
            <textarea data-question-key="names-analogy"></textarea>
          </div>
          <div class="question">
            <p>Implications for when/where the biblical Gospels were written.</p>
            <textarea data-question-key="names-implications"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>00:18:10 · Egypt & preservation</summary>
          <div class="question">
            <p>Egypt’s role in early manuscripts; near-loss stories.</p>
            <textarea data-question-key="egypt-role"></textarea>
          </div>
          <div class="question">
            <p>How survival connects to Isaiah 40:8.</p>
            <textarea data-question-key="egypt-isaiah"></textarea>
          </div>
          <div class="question">
            <p>Providence: more confident, less confident, or curious?</p>
            <textarea data-question-key="egypt-providence"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>00:19:50 · “Do we have the right words?”</summary>
          <div class="question">
            <p>First response to “changed too many times.”</p>
            <textarea data-question-key="words-response"></textarea>
          </div>
          <div class="question">
            <p>Why many handwritten copies instead of one vault copy?</p>
            <textarea data-question-key="words-many-copies"></textarea>
          </div>
          <div class="question">
            <p>Role of textual criticism for the church.</p>
            <textarea data-question-key="words-textual-criticism"></textarea>
          </div>
        </details>

        <details class="accordion">
          <summary>Personal reflection & application</summary>
          <div class="question">
            <p>Confidence: up, down, sharpened?</p>
            <textarea data-question-key="reflection-confidence"></textarea>
          </div>
          <div class="question">
            <p>Impact on prayer, Bible reading, trust in Jesus.</p>
            <textarea data-question-key="reflection-devotional"></textarea>
          </div>
          <div class="question">
            <p>One concrete step this month (book, rest of series, study Luke 1 or 1 Cor 15).</p>
            <textarea data-question-key="reflection-next-step"></textarea>
          </div>
        </details>

        <section class="card notes" style="margin-top: 14px;">
          <div class="tag">Rich text notes</div>
          <h3 style="margin: 10px 0 8px;">Keep your prompts handy</h3>
          <label for="notes">Rich text (keeps formatting when pasted from Word)</label>
          <div class="rte">
            <div class="rte-toolbar">
              <button type="button" data-cmd="bold"><strong>B</strong></button>
              <button type="button" data-cmd="italic"><em>I</em></button>
              <button type="button" data-cmd="underline"><u>U</u></button>
              <button type="button" data-cmd="insertUnorderedList">• List</button>
              <button type="button" data-cmd="insertOrderedList">1. List</button>
              <button type="button" data-cmd="formatBlock" data-value="h3">H3</button>
              <button type="button" data-cmd="formatBlock" data-value="p">Paragraph</button>
              <button type="button" data-cmd="removeFormat">Clear</button>
            </div>
            <div id="notes" class="rte-editor" contenteditable="true" spellcheck="true" aria-label="Presenter notes"></div>
          </div>
          <div class="note-actions">
            <button id="download-notes">Download notes</button>
            <button id="upload-notes">Load notes file</button>
            <input id="notes-file" type="file" accept="application/json,text/html,text/plain" style="display:none" />
          </div>
        </section>
      </section>

      <section class="card sticky">
        <div class="tag">Live controls</div>
        <h3 style="margin: 10px 0 12px;">Send commands to the display</h3>
        <div class="controls-grid">
          <button class="primary" id="toggle">Play / Pause</button>
          <button id="play">Play</button>
          <button id="pause">Pause</button>
          <button id="restart">Restart from 0:00</button>
          <button id="next">Skip to next pause</button>
          <button id="fullscreen">Fullscreen the display</button>
        </div>

        <div class="list" id="pause-list"></div>
        <div class="status" id="status">No commands sent yet.</div>
      </section>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    const config = window.BIBLE_STUDY_CONFIG || {};
    const VIDEO_ID = config.videoId || '';
    const pausePoints = Array.isArray(config.pausePoints) ? config.pausePoints : [];
    const CHANNEL_KEY = config.channelName || 'class1-control';
    const STORAGE_FALLBACK_KEY = `${CHANNEL_KEY}-storage`;
    const NOTES_KEY = 'class1-teacher-notes';
    const QUESTION_PREFIX = 'class1-question-';

    const channel = 'BroadcastChannel' in window ? new BroadcastChannel(CHANNEL_KEY) : null;
    const statusEl = document.getElementById('status');
    const pauseListEl = document.getElementById('pause-list');
    const notesEl = document.getElementById('notes');
    const downloadBtn = document.getElementById('download-notes');
    const uploadBtn = document.getElementById('upload-notes');
    const fileInput = document.getElementById('notes-file');
    const questionFields = Array.from(document.querySelectorAll('textarea[data-question-key]'));

    function sendCommand(type, payload = {}) {
      const message = { type, ...payload, sentAt: Date.now() };
      if (channel) channel.postMessage(message);
      try { localStorage.setItem(STORAGE_FALLBACK_KEY, JSON.stringify(message)); } catch (err) {}
      flashStatus(`Sent: ${labelFor(type, payload)}`);
    }

    function labelFor(type, payload) {
      if (type === 'jumpToPause' && Number.isInteger(payload.index)) {
        const point = pausePoints[payload.index];
        return point ? `Jump to ${point.label}` : 'Jump to pause';
      }
      if (type === 'nextPause') return 'Skip to next pause';
      if (type === 'fullscreen') return 'Fullscreen display';
      if (type === 'restart') return 'Restart video';
      if (type === 'toggle') return 'Play / Pause';
      return type.charAt(0).toUpperCase() + type.slice(1);
    }

    function flashStatus(text) {
      statusEl.textContent = text;
    }

    function renderPauseList() {
      pauseListEl.innerHTML = '';
      pausePoints.forEach((point, idx) => {
        const item = document.createElement('div');
        item.className = 'list-item';
        const label = document.createElement('div');
        label.innerHTML = `<strong>${point.label}</strong><br><small>${formatTime(point.time)}</small>`;
        const btn = document.createElement('button');
        btn.textContent = 'Jump here';
        btn.onclick = () => sendCommand('jumpToPause', { index: idx });
        item.appendChild(label);
        item.appendChild(btn);
        pauseListEl.appendChild(item);
      });
      if (pausePoints.length === 0) {
        const item = document.createElement('div');
        item.className = 'list-item';
        item.innerHTML = '<small>No planned pauses yet. Add them in config.js.</small>';
        pauseListEl.appendChild(item);
      }
    }

    function bindControls() {
      document.getElementById('toggle').onclick = () => sendCommand('toggle');
      document.getElementById('play').onclick = () => sendCommand('play');
      document.getElementById('pause').onclick = () => sendCommand('pause');
      document.getElementById('restart').onclick = () => sendCommand('restart');
      document.getElementById('next').onclick = () => sendCommand('nextPause');
      document.getElementById('fullscreen').onclick = () => sendCommand('fullscreen');
      downloadBtn.onclick = downloadNotes;
      uploadBtn.onclick = () => fileInput.click();
      fileInput.onchange = importNotes;
      document.querySelectorAll('.rte-toolbar button').forEach(btn => {
        btn.onclick = () => {
          const cmd = btn.dataset.cmd;
          const val = btn.dataset.value || null;
          document.execCommand(cmd, false, val);
          notesEl.focus();
          persistNotes();
        };
      });

      questionFields.forEach(field => {
        const key = field.dataset.questionKey;
        const stored = localStorage.getItem(QUESTION_PREFIX + key);
        if (stored) field.value = stored;
        field.addEventListener('input', () => {
          try { localStorage.setItem(QUESTION_PREFIX + key, field.value); } catch (err) {}
        });
      });
    }

    function hydrateNotes() {
      notesEl.innerHTML = localStorage.getItem(NOTES_KEY) || '';
      notesEl.addEventListener('input', persistNotes);
    }

    function persistNotes() {
      try { localStorage.setItem(NOTES_KEY, notesEl.innerHTML); } catch (err) {}
    }

    function downloadNotes() {
      const questions = {};
      questionFields.forEach(field => {
        questions[field.dataset.questionKey] = field.value;
      });
      const payload = {
        version: 1,
        notesHtml: notesEl.innerHTML || '',
        questions
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'class1-notes.json';
      a.click();
      URL.revokeObjectURL(url);
      flashStatus('Downloaded notes file (class1-notes.json).');
    }

    function importNotes(event) {
      const file = event.target.files && event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const text = reader.result || '';
        try {
          const parsed = JSON.parse(text);
          if (parsed && typeof parsed === 'object') {
            if (parsed.notesHtml) notesEl.innerHTML = parsed.notesHtml;
            if (parsed.questions && typeof parsed.questions === 'object') {
              questionFields.forEach(field => {
                const val = parsed.questions[field.dataset.questionKey];
                if (typeof val === 'string') field.value = val;
              });
            }
            persistNotes();
            questionFields.forEach(field => {
              try { localStorage.setItem(QUESTION_PREFIX + field.dataset.questionKey, field.value); } catch (err) {}
            });
            flashStatus('Imported notes and outline fields.');
            event.target.value = '';
            return;
          }
        } catch (err) {
          // fall through to treat as raw HTML
        }

        notesEl.innerHTML = text;
        persistNotes();
        flashStatus('Imported notes (rich text).');
        event.target.value = '';
      };
      reader.readAsText(file);
    }

    function formatTime(totalSeconds) {
      const m = Math.floor(totalSeconds / 60);
      const s = Math.floor(totalSeconds % 60);
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    renderPauseList();
    bindControls();
    hydrateNotes();
    flashStatus('Ready. Open the display page on the TV (index.html).');
  </script>
</body>
</html>
