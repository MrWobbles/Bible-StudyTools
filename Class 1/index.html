<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Can I Trust the Bible? — Class 1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b1f36;
      --panel: #0f2d4d;
      --accent: #f0b429;
      --text: #e6edf7;
      --muted: #9fb3cc;
      --shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Space Grotesk', system-ui, -apple-system, sans-serif;
      background: radial-gradient(120% 120% at 10% 20%, rgba(240, 180, 41, 0.12), transparent 45%),
        radial-gradient(120% 120% at 90% 0%, rgba(73, 161, 255, 0.15), transparent 40%),
        linear-gradient(135deg, #071327 0%, #0b1f36 50%, #0a1c31 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px 18px 20px;
      display: flex;
      justify-content: center;
    }

    .page {
      width: min(1280px, 100%);
      display: grid;
      gap: 22px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: space-between;
    }

    .title-group {
      display: grid;
      gap: 6px;
    }

    h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 40px);
      letter-spacing: -0.02em;
    }

    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 16px;
    }

    nav {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .pill {
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.12);
      text-decoration: none;
      font-weight: 600;
      letter-spacing: -0.01em;
      transition: all 0.2s ease;
    }

    .pill.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #0a1325;
      box-shadow: 0 8px 24px rgba(240, 180, 41, 0.45);
    }

    .pill:hover { transform: translateY(-2px); }

    .layout {
      display: grid;
      gap: 18px;
      grid-template-columns: 2fr 1fr;
    }

    @media (max-width: 960px) {
      .layout { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--panel);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      padding: 18px;
      box-shadow: var(--shadow);
    }

    .video-card {
      position: relative;
      overflow: hidden;
      min-height: 320px;
    }

    .player-shell {
      position: relative;
      width: 100%;
      padding-top: 56.25%;
      border-radius: 12px;
      overflow: hidden;
      background: #01060f;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    #player {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .controls {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      margin-top: 14px;
    }

    button {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.16);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: -0.01em;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button.primary {
      background: var(--accent);
      color: #0a1325;
      border-color: var(--accent);
      box-shadow: 0 6px 18px rgba(240, 180, 41, 0.35);
    }

    button:hover { transform: translateY(-1px); }

    .next-stop {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.12);
      padding: 10px 12px;
      border-radius: 12px;
      margin-top: 10px;
      color: var(--muted);
    }

    .next-stop strong { color: var(--text); }

    .list {
      display: grid;
      gap: 10px;
      margin-top: 10px;
    }

    .list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
    }

    .list-item small { color: var(--muted); }

    .note-card h3 {
      margin: 0 0 6px;
      font-size: 18px;
      letter-spacing: -0.01em;
    }

    .note-card p {
      margin: 0;
      color: var(--muted);
      line-height: 1.5;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.08);
      color: var(--muted);
      font-size: 13px;
      letter-spacing: -0.01em;
    }

    details.accordion {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px 14px;
      color: var(--text);
    }

    details.accordion + details.accordion { margin-top: 8px; }

    details.accordion summary {
      cursor: pointer;
      font-weight: 700;
      letter-spacing: -0.01em;
      list-style: none;
    }

    details.accordion summary::-webkit-details-marker { display: none; }

    details.accordion ul {
      margin: 8px 0 0;
      padding-left: 18px;
      color: var(--muted);
      line-height: 1.5;
    }

    details.accordion a { color: var(--accent); }

    /* Fullscreen styles */
    .player-shell:fullscreen,
    .player-shell:-webkit-full-screen,
    .player-shell:-moz-full-screen,
    .player-shell:-ms-fullscreen {
      width: 100vw;
      height: 100vh;
      padding-top: 0;
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }

    .player-shell:fullscreen #player,
    .player-shell:-webkit-full-screen #player,
    .player-shell:-moz-full-screen #player,
    .player-shell:-ms-fullscreen #player {
      width: auto;
      height: 100vh;
      aspect-ratio: 16 / 9;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="title-group">
        <h1>Can I Trust the Bible?</h1>
        <p class="subtitle">Class 1 · Origins and Reliability · Wes Huffman</p>
      </div>
      <nav>
        <a class="pill active" href="#">Class 1</a>
        <a class="pill" href="#">Class 2 (placeholder)</a>
        <a class="pill" href="#">Class 3 (placeholder)</a>
      </nav>
    </header>

    <div class="layout">
      <section class="card video-card" id="video-card">
        <div class="player-shell">
          <div id="player"></div>
        </div>

        <div class="controls">
          <button class="primary" id="toggle-play">Play / Pause</button>
          <button id="restart">Restart from 0:00</button>
          <button id="next-pause">Skip to next pause</button>
          <button id="fullscreen">Go fullscreen</button>
        </div>

        <div class="next-stop" id="next-stop">
          <span>Next planned pause:</span>
          <strong>loading…</strong>
        </div>

        <div class="list" id="pause-list"></div>
      </section>

      <section class="card note-card">
        <h3>Session flow</h3>
        <p>Quick prompts to keep you on track while the video plays.</p>
        <div class="list" id="session-outline">
          <details class="accordion" open>
            <summary>Prayer for discernment (James 1:5-8)</summary>
            <ul>
              <li>Ask for wisdom, faith without doubting, and stability.</li>
              <li>Set the tone before the video begins.</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>Foundations and assumptions</summary>
            <ul>
              <li>Why do you personally trust or not trust the Bible? What shaped that view?</li>
              <li>Responding to “You only believe because you grew up with it.”</li>
              <li>If the Bible were unreliable, what happens to your faith in Jesus?</li>
              <li>Objections you have heard: errors, changed over time, wrong books.</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>Canon and “right books”</summary>
            <ul>
              <li>What does “canon” mean? How were books chosen?</li>
              <li>Initial thoughts on “lost gospels” (Thomas, Judas).</li>
              <li>Read 2 Tim 3:16; 2 Pet 1:20-21 — expectations for Scripture.</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>00:07:05 · Recognizing Scripture</summary>
            <ul>
              <li>Video link: <a href="https://youtu.be/QhVPBNBAGY0" target="_blank" rel="noopener">https://youtu.be/QhVPBNBAGY0</a></li>
              <li>Recognized, not “voted in.” Why does recognition matter?</li>
              <li>Criteria hints (Luke 1:1-4; 1 John 1:1-3).</li>
              <li>OT–NT relationship and confidence in having the right books.</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>00:13:45 · Other gospels (Gospel of Thomas)</summary>
            <ul>
              <li>Pseudonymous names to borrow authority — how does that shape trust?</li>
              <li>Thomas = 114 sayings with secret knowledge; contrast with four Gospels.</li>
              <li>What feels out of step with Jesus of the canonical Gospels?</li>
              <li>Responding to “Church suppressed alternate Christianities.”</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>00:16:40 · Historical anchoring (names)</summary>
            <ul>
              <li>Name accuracy by time/place as evidence for reliability.</li>
              <li>Forgery analogy (17th c. Paris) — why details matter.</li>
              <li>What does name/location evidence suggest about when/where written?</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>00:18:10 · Egypt & preservation</summary>
            <ul>
              <li>Egypt’s role in early manuscripts; near-loss stories.</li>
              <li>How does survival interact with Isaiah 40:8?</li>
              <li>Providence: more confident, less confident, or curious?</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>00:19:50 · “Do we have the right words?”</summary>
            <ul>
              <li>Preliminary answer to “It was changed so many times.”</li>
              <li>Why thousands of handwritten copies instead of one vault copy?</li>
              <li>Role of textual criticism in serving the church.</li>
            </ul>
          </details>
          <details class="accordion">
            <summary>Personal reflection & application</summary>
            <ul>
              <li>Did confidence increase, decrease, or sharpen?</li>
              <li>Impact on prayer, Bible reading, trust in Jesus.</li>
              <li>One concrete step this month (book, rest of series, study Luke 1 or 1 Cor 15).</li>
            </ul>
          </details>
        </div>
      </section>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    let player;
    let monitorId = null;
    let nextPauseIndex = 0;
    let channel = null;
    let VIDEO_ID = '';
    let pausePoints = [];
    let CHANNEL_KEY = 'class1-control';
    let STORAGE_FALLBACK_KEY = 'class1-control-storage';

    function initConfig() {
      const config = window.BIBLE_STUDY_CONFIG || {};
      VIDEO_ID = config.videoId || '';
      pausePoints = Array.isArray(config.pausePoints) ? config.pausePoints : [];
      CHANNEL_KEY = config.channelName || 'class1-control';
      STORAGE_FALLBACK_KEY = `${CHANNEL_KEY}-storage`;
    }

    // Wait for config to load, then initialize YouTube API
    window.addEventListener('load', () => {
      initConfig();
      const tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      document.head.appendChild(tag);
    });

    setupControlChannel();

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: VIDEO_ID,
        playerVars: {
          rel: 0,
          modestbranding: 1,
          color: 'white',
          playsinline: 1
        },
        events: {
          onReady: onPlayerReady,
          onStateChange: onPlayerStateChange
        }
      });
    }

    function onPlayerReady() {
      renderPauseList();
      resetNextPause();
      bindControls();
    }

    function setupControlChannel() {
      if ('BroadcastChannel' in window) {
        channel = new BroadcastChannel(CHANNEL_KEY);
        channel.onmessage = handleRemoteCommand;
      }

      window.addEventListener('storage', event => {
        if (event.key !== STORAGE_FALLBACK_KEY || !event.newValue) return;
        try {
          const data = JSON.parse(event.newValue);
          handleRemoteCommand({ data });
        } catch (err) {
          console.warn('Control message failed to parse', err);
        }
      });
    }

    function handleRemoteCommand(event) {
      const data = event.data || event;
      if (!data || !data.type) return;

      switch (data.type) {
        case 'toggle':
          togglePlay();
          break;
        case 'play':
          if (player) player.playVideo();
          break;
        case 'pause':
          if (player) player.pauseVideo();
          break;
        case 'restart':
          restartVideo();
          break;
        case 'nextPause':
          skipToNextPause();
          break;
        case 'jumpToPause':
          if (Number.isInteger(data.index)) {
            const idx = Math.max(0, Math.min(data.index, pausePoints.length - 1));
            jumpToPause(idx);
          }
          break;
        case 'fullscreen':
          goFullscreen();
          break;
        default:
          break;
      }
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        resetNextPause();
        startMonitor();
      } else {
        stopMonitor();
      }
    }

    function startMonitor() {
      if (monitorId) return;
      monitorId = setInterval(checkForPause, 250);
    }

    function stopMonitor() {
      if (!monitorId) return;
      clearInterval(monitorId);
      monitorId = null;
    }

    function checkForPause() {
      if (!player || nextPauseIndex < 0 || nextPauseIndex >= pausePoints.length) return;
      const current = player.getCurrentTime();
      const target = pausePoints[nextPauseIndex].time;
      if (current >= target && player.getPlayerState() === YT.PlayerState.PLAYING) {
        player.pauseVideo();
        nextPauseIndex += 1;
        updateNextPauseText();
      }
    }

    function resetNextPause() {
      if (!player) return;
      const current = player.getCurrentTime ? player.getCurrentTime() : 0;
      nextPauseIndex = pausePoints.findIndex(p => p.time > current);
      updateNextPauseText();
    }

    function renderPauseList() {
      const list = document.getElementById('pause-list');
      list.innerHTML = '';
      pausePoints.forEach((point, idx) => {
        const item = document.createElement('div');
        item.className = 'list-item';
        const label = document.createElement('div');
        label.innerHTML = `<strong>${point.label}</strong><br><small>${formatTime(point.time)}</small>`;
        const btn = document.createElement('button');
        btn.textContent = 'Jump here';
        btn.onclick = () => jumpToPause(idx);
        item.appendChild(label);
        item.appendChild(btn);
        list.appendChild(item);
      });
      updateNextPauseText();
    }

    function updateNextPauseText() {
      const el = document.getElementById('next-stop').querySelector('strong');
      if (nextPauseIndex === -1 || nextPauseIndex >= pausePoints.length) {
        el.textContent = 'No more planned pauses';
      } else {
        const next = pausePoints[nextPauseIndex];
        el.textContent = `${next.label} · ${formatTime(next.time)}`;
      }
    }

    function jumpToPause(idx) {
      if (!player) return;
      const target = pausePoints[idx].time;
      player.seekTo(Math.max(0, target - 0.25), true);
      nextPauseIndex = idx;
      updateNextPauseText();
      player.playVideo();
    }

    function togglePlay() {
      if (!player) return;
      const state = player.getPlayerState();
      if (state === YT.PlayerState.PLAYING) {
        player.pauseVideo();
      } else {
        player.playVideo();
      }
    }

    function restartVideo() {
      if (!player) return;
      player.seekTo(0, true);
      player.playVideo();
      resetNextPause();
    }

    function skipToNextPause() {
      if (!player || nextPauseIndex === -1 || nextPauseIndex >= pausePoints.length) return;
      jumpToPause(nextPauseIndex);
    }

    function goFullscreen() {
      // Try the YouTube iframe first (allows fullscreen even from remote commands)
      const playerFrame = document.querySelector('#player iframe');
      if (playerFrame) {
        const request = playerFrame.requestFullscreen || playerFrame.webkitRequestFullscreen || playerFrame.mozRequestFullScreen || playerFrame.msRequestFullscreen;
        if (request) {
          console.log('Attempting fullscreen on YouTube iframe');
          request.call(playerFrame).catch(err => console.error('Fullscreen error:', err));
          return;
        }
      }
      
      // Fallback to player-shell
      const playerShell = document.querySelector('.player-shell');
      if (!playerShell) {
        console.error('Neither iframe nor player-shell found');
        return;
      }
      const request = playerShell.requestFullscreen || playerShell.webkitRequestFullscreen || playerShell.mozRequestFullScreen || playerShell.msRequestFullscreen;
      if (request) {
        console.log('Attempting fullscreen on .player-shell');
        request.call(playerShell).catch(err => console.error('Fullscreen error:', err));
      }
    }

    function bindControls() {
      document.getElementById('toggle-play').onclick = togglePlay;
      document.getElementById('restart').onclick = restartVideo;
      document.getElementById('next-pause').onclick = skipToNextPause;
      document.getElementById('fullscreen').onclick = goFullscreen;
    }

    function formatTime(totalSeconds) {
      const m = Math.floor(totalSeconds / 60);
      const s = Math.floor(totalSeconds % 60);
      return `${m}:${s.toString().padStart(2, '0')}`;
    }
  </script>
</body>
</html>
